<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PMEL Notes - Ù…Ù„Ø§Ø­Ø¸Ø§ØªÙŠ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .header h1 {
            color: white;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            color: rgba(255, 255, 255, 0.8);
            font-size: 1.1em;
        }

        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .btn {
            background: linear-gradient(45deg, #ff6b6b, #ff8e8e);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4);
        }

        .btn.folder-btn {
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            box-shadow: 0 4px 15px rgba(78, 205, 196, 0.3);
        }

        .btn.folder-btn:hover {
            box-shadow: 0 6px 20px rgba(78, 205, 196, 0.4);
        }

        .content-area {
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 20px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            min-height: 500px;
        }

        .sidebar {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .sidebar h3 {
            color: white;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .folder-list {
            list-style: none;
        }

        .folder-item {
            background: rgba(255, 255, 255, 0.1);
            margin: 8px 0;
            padding: 12px 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .folder-item:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateX(-5px);
        }

        .folder-item.active {
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            color: white;
        }

        .folder-name {
            color: white;
            font-weight: 500;
        }

        .delete-folder {
            background: #ff4757;
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .notes-area {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .notes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .note-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .note-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
        }

        .note-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .note-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #333;
        }

        .note-date {
            font-size: 0.9em;
            color: #666;
        }

        .note-content {
            color: #555;
            line-height: 1.6;
            margin-bottom: 15px;
            max-height: 150px;
            overflow-y: auto;
        }

        .note-actions {
            display: flex;
            gap: 10px;
        }

        .note-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .edit-btn {
            background: #4ecdc4;
            color: white;
        }

        .delete-btn {
            background: #ff4757;
            color: white;
        }

        .note-btn:hover {
            transform: scale(1.05);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 5% auto;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 600px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .modal h2 {
            color: white;
            margin-bottom: 20px;
            text-align: center;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: white;
            font-weight: bold;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.9);
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            background: white;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
        }

        .form-group textarea {
            height: 120px;
            resize: vertical;
        }

        .modal-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        .close {
            color: white;
            float: left;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .close:hover {
            color: #ff4757;
        }

        .file-preview {
            margin-top: 10px;
            padding: 10px;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px dashed rgba(255, 255, 255, 0.3);
            text-align: center;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        .file-preview img,
        .file-preview video {
            max-width: 100%;
            max-height: 200px;
            border-radius: 10px;
            margin-bottom: 10px;
        }

        .file-preview .file-info {
            color: white;
            font-size: 14px;
        }

        .remove-file {
            background: #ff4757;
            color: white;
            border: none;
            border-radius: 20px;
            padding: 5px 15px;
            cursor: pointer;
            font-size: 12px;
            margin-top: 10px;
        }

        .note-media {
            margin: 15px 0;
            text-align: center;
        }

        .note-media img,
        .note-media video {
            max-width: 100%;
            max-height: 200px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .note-media video {
            width: 100%;
        }

        .search-filter-section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .search-container {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .search-container input {
            flex: 1;
            padding: 12px 20px;
            border: none;
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.9);
            font-size: 16px;
            outline: none;
        }

        .search-btn {
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .search-btn:hover {
            transform: scale(1.05);
        }

        .filters-container {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }

        .filters-container select {
            padding: 10px 15px;
            border: none;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            outline: none;
            cursor: pointer;
        }

        .filter-btn {
            background: linear-gradient(45deg, #ff6b6b, #ff8e8e);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .filter-btn:hover {
            transform: scale(1.05);
        }

        .tags-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .tag {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .tag:hover {
            transform: scale(1.05);
        }

        .tag.active {
            border-color: white;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }

        .tag.work { background: linear-gradient(45deg, #ff6b6b, #ff8e8e); }
        .tag.personal { background: linear-gradient(45deg, #4ecdc4, #44a08d); }
        .tag.study { background: linear-gradient(45deg, #45b7d1, #96c93d); }
        .tag.important { background: linear-gradient(45deg, #f093fb, #f5576c); }
        .tag.idea { background: linear-gradient(45deg, #ffecd2, #fcb69f); }

        .selected-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 10px;
        }

        .selected-tag {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .remove-tag {
            background: rgba(255, 255, 255, 0.3);
            border: none;
            color: white;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            cursor: pointer;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .priority-badge {
            padding: 4px 8px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: bold;
            color: white;
            margin-right: 8px;
        }

        .priority-high { background: #ff4757; }
        .priority-medium { background: #ffa502; }
        .priority-low { background: #2ed573; }

        .note-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            margin: 10px 0;
        }

        .note-tag {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: bold;
        }

        .search-highlight {
            background: yellow;
            color: black;
            padding: 2px 4px;
            border-radius: 3px;
        }

        @media (max-width: 768px) {
            .content-area {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
            
            .notes-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>PMEL Notes</h1>
            <p>Ù†Ø¸Ù… Ù…Ù„Ø§Ø­Ø¸Ø§ØªÙƒ Ø¨Ø³Ù‡ÙˆÙ„Ø© ÙˆØ£Ù†Ø§Ù‚Ø©</p>
        </div>

        <div class="controls">
            <button class="btn folder-btn" onclick="openFolderModal()">Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù„Ø¯ Ø¬Ø¯ÙŠØ¯</button>
            <button class="btn" onclick="openNoteModal()">Ø¥Ø¶Ø§ÙØ© Ù…Ù„Ø§Ø­Ø¸Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
        </div>

        <div class="search-filter-section">
            <div class="search-container">
                <input type="text" id="searchInput" placeholder="Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª..." onkeyup="performSearch()">
                <button class="search-btn" onclick="performSearch()">ğŸ”</button>
            </div>
            
            <div class="filters-container">
                <select id="sortFilter" onchange="applySorting()">
                    <option value="date-desc">Ø§Ù„Ø£Ø­Ø¯Ø« Ø£ÙˆÙ„Ø§Ù‹</option>
                    <option value="date-asc">Ø§Ù„Ø£Ù‚Ø¯Ù… Ø£ÙˆÙ„Ø§Ù‹</option>
                    <option value="title-asc">Ø§Ù„Ø¹Ù†ÙˆØ§Ù† (Ø£-ÙŠ)</option>
                    <option value="title-desc">Ø§Ù„Ø¹Ù†ÙˆØ§Ù† (ÙŠ-Ø£)</option>
                    <option value="priority-desc">Ø§Ù„Ø£Ù‡Ù…ÙŠØ© (Ø¹Ø§Ù„ÙŠØ© Ø£ÙˆÙ„Ø§Ù‹)</option>
                    <option value="priority-asc">Ø§Ù„Ø£Ù‡Ù…ÙŠØ© (Ù…Ù†Ø®ÙØ¶Ø© Ø£ÙˆÙ„Ø§Ù‹)</option>
                </select>
                
                <select id="typeFilter" onchange="applyFilters()">
                    <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù†ÙˆØ§Ø¹</option>
                    <option value="text">Ù†Øµ ÙÙ‚Ø·</option>
                    <option value="image">Ù…Ø¹ ØµÙˆØ±</option>
                    <option value="video">Ù…Ø¹ ÙÙŠØ¯ÙŠÙˆ</option>
                </select>
                
                <select id="priorityFilter" onchange="applyFilters()">
                    <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ§Øª</option>
                    <option value="high">Ø¹Ø§Ù„ÙŠØ© Ø§Ù„Ø£Ù‡Ù…ÙŠØ©</option>
                    <option value="medium">Ù…ØªÙˆØ³Ø·Ø© Ø§Ù„Ø£Ù‡Ù…ÙŠØ©</option>
                    <option value="low">Ù…Ù†Ø®ÙØ¶Ø© Ø§Ù„Ø£Ù‡Ù…ÙŠØ©</option>
                </select>
                
                <button class="filter-btn" onclick="clearFilters()">Ù…Ø³Ø­ Ø§Ù„ÙÙ„Ø§ØªØ±</button>
            </div>
            
            <div class="tags-filter">
                <div id="tagsFilter" class="tags-container"></div>
            </div>
        </div>

        <div class="content-area">
            <div class="sidebar">
                <h3>Ø§Ù„Ù…Ø¬Ù„Ø¯Ø§Øª</h3>
                <ul class="folder-list" id="folderList">
                    <li class="folder-item active" onclick="selectFolder('all')">
                        <span class="folder-name">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</span>
                    </li>
                </ul>
            </div>

            <div class="notes-area">
                <div id="notesContainer" class="notes-grid">
                    <div class="empty-state">
                        <h3>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</h3>
                        <p>Ø§Ø¨Ø¯Ø£ Ø¨Ø¥Ù†Ø´Ø§Ø¡ Ø£ÙˆÙ„ Ù…Ù„Ø§Ø­Ø¸Ø© Ù„Ùƒ!</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for creating folders -->
    <div id="folderModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeFolderModal()">&times;</span>
            <h2>Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù„Ø¯ Ø¬Ø¯ÙŠØ¯</h2>
            <div class="form-group">
                <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø¬Ù„Ø¯:</label>
                <input type="text" id="folderName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø¬Ù„Ø¯">
            </div>
            <div class="modal-actions">
                <button class="btn folder-btn" onclick="createFolder()">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø¬Ù„Ø¯</button>
                <button class="btn" onclick="closeFolderModal()">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </div>
    </div>

    <!-- Modal for creating/editing notes -->
    <div id="noteModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeNoteModal()">&times;</span>
            <h2 id="noteModalTitle">Ø¥Ø¶Ø§ÙØ© Ù…Ù„Ø§Ø­Ø¸Ø© Ø¬Ø¯ÙŠØ¯Ø©</h2>
            <div class="form-group">
                <label>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©:</label>
                <input type="text" id="noteTitle" placeholder="Ø£Ø¯Ø®Ù„ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©">
            </div>
            <div class="form-group">
                <label>Ø§Ù„Ù…Ø¬Ù„Ø¯:</label>
                <select id="noteFolder">
                    <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¬Ù„Ø¯</option>
                </select>
            </div>
            <div class="form-group">
                <label>Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©:</label>
                <select id="notePriority">
                    <option value="medium">Ù…ØªÙˆØ³Ø·Ø©</option>
                    <option value="high">Ø¹Ø§Ù„ÙŠØ©</option>
                    <option value="low">Ù…Ù†Ø®ÙØ¶Ø©</option>
                </select>
            </div>
            <div class="form-group">
                <label>Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label>
                <input type="text" id="noteTags" placeholder="Ù…Ø«Ø§Ù„: Ø¹Ù…Ù„ØŒ Ù…Ù‡Ù…ØŒ ÙÙƒØ±Ø© (ÙØµÙ„ Ø¨ÙÙˆØ§ØµÙ„)">
                <div class="tags-input-container">
                    <div id="selectedTags" class="selected-tags"></div>
                </div>
            </div>
            <div class="form-group">
                <label>Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©:</label>
                <textarea id="noteContent" placeholder="Ø§ÙƒØªØ¨ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© Ù‡Ù†Ø§..."></textarea>
            </div>
            <div class="form-group">
                <label>Ø¥Ø±ÙØ§Ù‚ ØµÙˆØ±Ø© Ø£Ùˆ ÙÙŠØ¯ÙŠÙˆ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label>
                <input type="file" id="noteFile" accept="image/*,video/*" onchange="handleFileUpload(event)">
                <div id="filePreview" class="file-preview"></div>
            </div>
            <div class="modal-actions">
                <button class="btn" onclick="saveNote()" id="saveNoteBtn">Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©</button>
                <button class="btn" onclick="closeNoteModal()">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </div>
    </div>

    <script>
        let folders = [];
        let notes = [];
        let currentFolder = 'all';
        let editingNoteId = null;
        let currentFileData = null;
        let currentFileName = null;
        let allTags = new Set();
        let activeFilters = {
            search: '',
            sort: 'date-desc',
            type: 'all',
            priority: 'all',
            tags: []
        };

        // Load data from memory
        function loadData() {
            // Initialize with some sample data if empty
            if (folders.length === 0) {
                folders = [
                    { id: 1, name: 'Ø§Ù„Ø¹Ù…Ù„' },
                    { id: 2, name: 'Ø§Ù„Ø¯Ø±Ø§Ø³Ø©' },
                    { id: 3, name: 'Ø´Ø®ØµÙŠ' }
                ];
            }
            
            if (notes.length === 0) {
                notes = [
                    {
                        id: 1,
                        title: 'Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ PMEL Notes',
                        content: 'Ù‡Ø°Ø§ Ù…Ø«Ø§Ù„ Ø¹Ù„Ù‰ Ù…Ù„Ø§Ø­Ø¸Ø©. ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© ÙˆØªÙ†Ø¸ÙŠÙ…Ù‡Ø§ ÙÙŠ Ù…Ø¬Ù„Ø¯Ø§ØªØŒ ÙƒÙ…Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø±ÙØ§Ù‚ Ø§Ù„ØµÙˆØ± ÙˆÙ…Ù‚Ø§Ø·Ø¹ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ÙˆØ¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª.',
                        folder: 'Ø´Ø®ØµÙŠ',
                        date: new Date().toLocaleDateString('ar-SA'),
                        priority: 'high',
                        tags: ['Ù…Ø±Ø­Ø¨Ø§', 'Ù…Ù‡Ù…', 'Ø¨Ø¯Ø§ÙŠØ©'],
                        fileData: null,
                        fileName: null,
                        fileType: null
                    },
                    {
                        id: 2,
                        title: 'Ù…Ø«Ø§Ù„ Ø¹Ù„Ù‰ Ù…Ù„Ø§Ø­Ø¸Ø© Ø¹Ù…Ù„',
                        content: 'Ù‡Ø°Ù‡ Ù…Ù„Ø§Ø­Ø¸Ø© ØªØªØ¹Ù„Ù‚ Ø¨Ø§Ù„Ø¹Ù…Ù„ Ù…Ø¹ Ø£ÙˆÙ„ÙˆÙŠØ© Ù…ØªÙˆØ³Ø·Ø©.',
                        folder: 'Ø§Ù„Ø¹Ù…Ù„',
                        date: new Date(Date.now() - 86400000).toLocaleDateString('ar-SA'),
                        priority: 'medium',
                        tags: ['Ø¹Ù…Ù„', 'Ù…Ø´Ø±ÙˆØ¹'],
                        fileData: null,
                        fileName: null,
                        fileType: null
                    }
                ];
                
                // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª
                notes.forEach(note => {
                    if (note.tags) {
                        note.tags.forEach(tag => allTags.add(tag));
                    }
                });
            }
            
            updateFolderList();
            updateTagsFilter();
            displayNotes();
        }

        // Update folder list
        function updateFolderList() {
            const folderList = document.getElementById('folderList');
            const noteFolder = document.getElementById('noteFolder');
            
            // Clear existing folders (except "All Notes")
            const allNotesItem = folderList.querySelector('.folder-item');
            folderList.innerHTML = '';
            folderList.appendChild(allNotesItem);
            
            // Clear note folder select
            noteFolder.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¬Ù„Ø¯</option>';
            
            folders.forEach(folder => {
                // Add to sidebar
                const li = document.createElement('li');
                li.className = 'folder-item';
                li.onclick = () => selectFolder(folder.name);
                li.innerHTML = `
                    <span class="folder-name">${folder.name}</span>
                    <button class="delete-folder" onclick="deleteFolder(${folder.id}, event)">Ã—</button>
                `;
                folderList.appendChild(li);
                
                // Add to select
                const option = document.createElement('option');
                option.value = folder.name;
                option.textContent = folder.name;
                noteFolder.appendChild(option);
            });
        }

        // Update tags filter
        function updateTagsFilter() {
            const tagsFilter = document.getElementById('tagsFilter');
            tagsFilter.innerHTML = '';
            
            if (allTags.size > 0) {
                allTags.forEach(tag => {
                    const tagElement = document.createElement('span');
                    tagElement.className = `tag ${getTagClass(tag)}`;
                    tagElement.textContent = tag;
                    tagElement.onclick = () => toggleTagFilter(tag, tagElement);
                    tagsFilter.appendChild(tagElement);
                });
            }
        }

        // Get tag class based on tag name
        function getTagClass(tag) {
            const tagLower = tag.toLowerCase();
            if (tagLower.includes('Ø¹Ù…Ù„') || tagLower.includes('work')) return 'work';
            if (tagLower.includes('Ø´Ø®ØµÙŠ') || tagLower.includes('personal')) return 'personal';
            if (tagLower.includes('Ø¯Ø±Ø§Ø³Ø©') || tagLower.includes('study')) return 'study';
            if (tagLower.includes('Ù…Ù‡Ù…') || tagLower.includes('important')) return 'important';
            if (tagLower.includes('ÙÙƒØ±Ø©') || tagLower.includes('idea')) return 'idea';
            return '';
        }

        // Toggle tag filter
        function toggleTagFilter(tag, element) {
            const index = activeFilters.tags.indexOf(tag);
            if (index > -1) {
                activeFilters.tags.splice(index, 1);
                element.classList.remove('active');
            } else {
                activeFilters.tags.push(tag);
                element.classList.add('active');
            }
            applyFilters();
        }
        function selectFolder(folderName) {
            currentFolder = folderName;
            
            // Update active folder
            document.querySelectorAll('.folder-item').forEach(item => {
                item.classList.remove('active');
            });
            
            event.target.closest('.folder-item').classList.add('active');
            
            displayNotes();
        }

        // Display notes with filtering and sorting
        function displayNotes() {
            const notesContainer = document.getElementById('notesContainer');
            let filteredNotes = [...notes];
            
            // Apply folder filter
            if (currentFolder !== 'all') {
                filteredNotes = filteredNotes.filter(note => note.folder === currentFolder);
            }
            
            // Apply search filter
            if (activeFilters.search) {
                const searchTerm = activeFilters.search.toLowerCase();
                filteredNotes = filteredNotes.filter(note => 
                    note.title.toLowerCase().includes(searchTerm) ||
                    note.content.toLowerCase().includes(searchTerm) ||
                    (note.tags && note.tags.some(tag => tag.toLowerCase().includes(searchTerm)))
                );
            }
            
            // Apply type filter
            if (activeFilters.type !== 'all') {
                filteredNotes = filteredNotes.filter(note => {
                    if (activeFilters.type === 'text') return !note.fileData;
                    if (activeFilters.type === 'image') return note.fileType === 'image';
                    if (activeFilters.type === 'video') return note.fileType === 'video';
                    return true;
                });
            }
            
            // Apply priority filter
            if (activeFilters.priority !== 'all') {
                filteredNotes = filteredNotes.filter(note => note.priority === activeFilters.priority);
            }
            
            // Apply tags filter
            if (activeFilters.tags.length > 0) {
                filteredNotes = filteredNotes.filter(note => 
                    note.tags && activeFilters.tags.some(tag => note.tags.includes(tag))
                );
            }
            
            // Apply sorting
            filteredNotes.sort((a, b) => {
                switch (activeFilters.sort) {
                    case 'date-desc':
                        return new Date(b.date) - new Date(a.date);
                    case 'date-asc':
                        return new Date(a.date) - new Date(b.date);
                    case 'title-asc':
                        return a.title.localeCompare(b.title, 'ar');
                    case 'title-desc':
                        return b.title.localeCompare(a.title, 'ar');
                    case 'priority-desc':
                        const priorityOrder = { high: 3, medium: 2, low: 1 };
                        return priorityOrder[b.priority] - priorityOrder[a.priority];
                    case 'priority-asc':
                        const priorityOrderAsc = { high: 1, medium: 2, low: 3 };
                        return priorityOrderAsc[a.priority] - priorityOrderAsc[b.priority];
                    default:
                        return 0;
                }
            });
            
            if (filteredNotes.length === 0) {
                notesContainer.innerHTML = `
                    <div class="empty-state">
                        <h3>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù„Ø¨Ø­Ø«</h3>
                        <p>Ø¬Ø±Ø¨ ØªØºÙŠÙŠØ± Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø¨Ø­Ø« Ø£Ùˆ Ø§Ù„ÙÙ„ØªØ±Ø©</p>
                    </div>
                `;
                return;
            }
            
            notesContainer.innerHTML = filteredNotes.map(note => {
                const priorityClass = `priority-${note.priority}`;
                const priorityText = note.priority === 'high' ? 'Ø¹Ø§Ù„ÙŠØ©' : 
                                   note.priority === 'medium' ? 'Ù…ØªÙˆØ³Ø·Ø©' : 'Ù…Ù†Ø®ÙØ¶Ø©';
                
                let highlightedTitle = note.title;
                let highlightedContent = note.content;
                
                if (activeFilters.search) {
                    const regex = new RegExp(`(${activeFilters.search})`, 'gi');
                    highlightedTitle = highlightedTitle.replace(regex, '<span class="search-highlight">$1</span>');
                    highlightedContent = highlightedContent.replace(regex, '<span class="search-highlight">$1</span>');
                }
                
                return `
                    <div class="note-card">
                        <div class="note-header">
                            <div class="note-title">${highlightedTitle}</div>
                            <div class="note-date">${note.date}</div>
                        </div>
                        <div class="priority-badge ${priorityClass}">Ø£ÙˆÙ„ÙˆÙŠØ© ${priorityText}</div>
                        <div class="note-content">${highlightedContent}</div>
                        ${note.tags && note.tags.length > 0 ? `
                            <div class="note-tags">
                                ${note.tags.map(tag => `<span class="note-tag ${getTagClass(tag)}">${tag}</span>`).join('')}
                            </div>
                        ` : ''}
                        ${note.fileData ? `
                            <div class="note-media">
                                ${note.fileType === 'image' ? 
                                    `<img src="${note.fileData}" alt="Ù…Ø±ÙÙ‚">` : 
                                    `<video controls src="${note.fileData}"></video>`
                                }
                                <div class="media-filename">${note.fileName}</div>
                            </div>
                        ` : ''}
                        <div class="note-actions">
                            <button class="note-btn edit-btn" onclick="editNote(${note.id})">ØªØ¹Ø¯ÙŠÙ„</button>
                            <button class="note-btn delete-btn" onclick="deleteNote(${note.id})">Ø­Ø°Ù</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Open folder modal
        function openFolderModal() {
            document.getElementById('folderModal').style.display = 'block';
            document.getElementById('folderName').value = '';
        }

        // Close folder modal
        function closeFolderModal() {
            document.getElementById('folderModal').style.display = 'none';
        }

        // Create folder
        function createFolder() {
            const folderName = document.getElementById('folderName').value.trim();
            
            if (!folderName) {
                alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø¬Ù„Ø¯');
                return;
            }
            
            if (folders.some(f => f.name === folderName)) {
                alert('ÙŠÙˆØ¬Ø¯ Ù…Ø¬Ù„Ø¯ Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø§Ø³Ù… Ø¨Ø§Ù„ÙØ¹Ù„');
                return;
            }
            
            const newFolder = {
                id: Date.now(),
                name: folderName
            };
            
            folders.push(newFolder);
            updateFolderList();
            closeFolderModal();
        }

        // Delete folder
        function deleteFolder(folderId, event) {
            event.stopPropagation();
            
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ø¬Ù„Ø¯ØŸ Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¨Ø¯Ø§Ø®Ù„Ù‡.')) {
                const folder = folders.find(f => f.id === folderId);
                if (folder) {
                    notes = notes.filter(note => note.folder !== folder.name);
                    folders = folders.filter(f => f.id !== folderId);
                    updateFolderList();
                    displayNotes();
                }
            }
        }

        // Search functionality
        function performSearch() {
            activeFilters.search = document.getElementById('searchInput').value.trim();
            displayNotes();
        }

        // Apply sorting
        function applySorting() {
            activeFilters.sort = document.getElementById('sortFilter').value;
            displayNotes();
        }

        // Apply filters
        function applyFilters() {
            activeFilters.type = document.getElementById('typeFilter').value;
            activeFilters.priority = document.getElementById('priorityFilter').value;
            displayNotes();
        }

        // Clear all filters
        function clearFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('sortFilter').value = 'date-desc';
            document.getElementById('typeFilter').value = 'all';
            document.getElementById('priorityFilter').value = 'all';
            
            activeFilters = {
                search: '',
                sort: 'date-desc',
                type: 'all',
                priority: 'all',
                tags: []
            };
            
            // Clear active tags
            document.querySelectorAll('.tag.active').forEach(tag => {
                tag.classList.remove('active');
            });
            
            displayNotes();
        }

        // Process tags input
        function processTags(tagsString) {
            if (!tagsString) return [];
            return tagsString.split(',').map(tag => tag.trim()).filter(tag => tag.length > 0);
        }

        // Update selected tags display
        function updateSelectedTags(tags) {
            const container = document.getElementById('selectedTags');
            container.innerHTML = tags.map(tag => `
                <span class="selected-tag ${getTagClass(tag)}">
                    ${tag}
                    <button class="remove-tag" onclick="removeSelectedTag('${tag}')">Ã—</button>
                </span>
            `).join('');
        }

        // Remove selected tag
        function removeSelectedTag(tagToRemove) {
            const input = document.getElementById('noteTags');
            const currentTags = processTags(input.value);
            const updatedTags = currentTags.filter(tag => tag !== tagToRemove);
            input.value = updatedTags.join(', ');
            updateSelectedTags(updatedTags);
        }
        function handleFileUpload(event) {
            const file = event.target.files[0];
            const preview = document.getElementById('filePreview');
            
            if (file) {
                const reader = new FileReader();
                const fileType = file.type.startsWith('image/') ? 'image' : 'video';
                
                reader.onload = function(e) {
                    currentFileData = e.target.result;
                    currentFileName = file.name;
                    
                    if (fileType === 'image') {
                        preview.innerHTML = `
                            <img src="${currentFileData}" alt="Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØ±Ø©">
                            <div class="file-info">${file.name}</div>
                            <button class="remove-file" onclick="removeFile()">Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ù„Ù</button>
                        `;
                    } else {
                        preview.innerHTML = `
                            <video src="${currentFileData}" controls></video>
                            <div class="file-info">${file.name}</div>
                            <button class="remove-file" onclick="removeFile()">Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ù„Ù</button>
                        `;
                    }
                };
                
                reader.readAsDataURL(file);
            }
        }

        // Remove uploaded file
        function removeFile() {
            currentFileData = null;
            currentFileName = null;
            document.getElementById('noteFile').value = '';
            document.getElementById('filePreview').innerHTML = '';
        }
        function openNoteModal() {
            document.getElementById('noteModal').style.display = 'block';
            document.getElementById('noteModalTitle').textContent = 'Ø¥Ø¶Ø§ÙØ© Ù…Ù„Ø§Ø­Ø¸Ø© Ø¬Ø¯ÙŠØ¯Ø©';
            document.getElementById('saveNoteBtn').textContent = 'Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©';
            document.getElementById('noteTitle').value = '';
            document.getElementById('noteContent').value = '';
            document.getElementById('noteFolder').value = '';
            editingNoteId = null;
        }

        // Close note modal
        function closeNoteModal() {
            document.getElementById('noteModal').style.display = 'none';
        }

        // Save note
        function saveNote() {
            const title = document.getElementById('noteTitle').value.trim();
            const content = document.getElementById('noteContent').value.trim();
            const folder = document.getElementById('noteFolder').value;
            
            if (!title || !content) {
                alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¹Ù†ÙˆØ§Ù† ÙˆÙ…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©');
                return;
            }
            
            if (editingNoteId) {
                // Edit existing note
                const noteIndex = notes.findIndex(n => n.id === editingNoteId);
                if (noteIndex !== -1) {
                    notes[noteIndex] = {
                        ...notes[noteIndex],
                        title,
                        content,
                        folder: folder || 'Ø¨Ø¯ÙˆÙ† Ù…Ø¬Ù„Ø¯',
                        fileData: currentFileData || notes[noteIndex].fileData,
                        fileName: currentFileName || notes[noteIndex].fileName,
                        fileType: currentFileData ? (currentFileData.startsWith('data:image/') ? 'image' : 'video') : notes[noteIndex].fileType
                    };
                }
            } else {
                // Create new note
                const newNote = {
                    id: Date.now(),
                    title,
                    content,
                    folder: folder || 'Ø¨Ø¯ÙˆÙ† Ù…Ø¬Ù„Ø¯',
                    date: new Date().toLocaleDateString('ar-SA'),
                    fileData: currentFileData,
                    fileName: currentFileName,
                    fileType: currentFileData ? (currentFileData.startsWith('data:image/') ? 'image' : 'video') : null
                };
                notes.push(newNote);
            }
            
            displayNotes();
            closeNoteModal();
        }

        // Edit note
        function editNote(noteId) {
            const note = notes.find(n => n.id === noteId);
            if (note) {
                document.getElementById('noteModal').style.display = 'block';
                document.getElementById('noteModalTitle').textContent = 'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©';
                document.getElementById('saveNoteBtn').textContent = 'Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª';
                document.getElementById('noteTitle').value = note.title;
                document.getElementById('noteContent').value = note.content;
                document.getElementById('noteFolder').value = note.folder;
                
                currentFileData = note.fileData;
                currentFileName = note.fileName;
                
                const preview = document.getElementById('filePreview');
                if (note.fileData) {
                    if (note.fileType === 'image') {
                        preview.innerHTML = `
                            <img src="${note.fileData}" alt="Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØ±Ø©">
                            <div class="file-info">${note.fileName}</div>
                            <button class="remove-file" onclick="removeFile()">Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ù„Ù</button>
                        `;
                    } else {
                        preview.innerHTML = `
                            <video src="${note.fileData}" controls></video>
                            <div class="file-info">${note.fileName}</div>
                            <button class="remove-file" onclick="removeFile()">Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ù„Ù</button>
                        `;
                    }
                } else {
                    preview.innerHTML = '';
                }
                
                editingNoteId = noteId;
            }
        }

        // Delete note
        function deleteNote(noteId) {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©ØŸ')) {
                notes = notes.filter(n => n.id !== noteId);
                displayNotes();
            }
        }

        // Close modals when clicking outside
        window.onclick = function(event) {
            const folderModal = document.getElementById('folderModal');
            const noteModal = document.getElementById('noteModal');
            
            if (event.target === folderModal) {
                closeFolderModal();
            }
            if (event.target === noteModal) {
                closeNoteModal();
            }
        }

        // Initialize the app
        loadData();
    </script>
</body>
</html>